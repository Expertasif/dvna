
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>A3 Cross-site Scripting Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="a4-idor.html" />
    
    
    <link rel="prev" href="a2-broken-auth.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../setup.html">
            
                <a href="../setup.html">
            
                    
                    Setup
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Solution</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="a1-injection.html">
            
                <a href="a1-injection.html">
            
                    
                    A1 Injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="a2-broken-auth.html">
            
                <a href="a2-broken-auth.html">
            
                    
                    A2 Broken Authentication and Session Management
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.3" data-path="a3-xss.html">
            
                <a href="a3-xss.html">
            
                    
                    A3 Cross-site Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="a4-idor.html">
            
                <a href="a4-idor.html">
            
                    
                    A4 Insecure Direct Object Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="a5-securty-misconfig.html">
            
                <a href="a5-securty-misconfig.html">
            
                    
                    A5 Security Misconfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="a6-sensitive-data-exposure.html">
            
                <a href="a6-sensitive-data-exposure.html">
            
                    
                    A6 Sensitive Data Exposure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="a7-missing-function-level-access-control.html">
            
                <a href="a7-missing-function-level-access-control.html">
            
                    
                    A7 Missing Function Level Access Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="a8-csrf.html">
            
                <a href="a8-csrf.html">
            
                    
                    A8 Cross-site Request Forgery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="a9-using-components-with-known-vulnerability.html">
            
                <a href="a9-using-components-with-known-vulnerability.html">
            
                    
                    A9 Using Components with Known Vulnerability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="a10-unvalidated-redirects-and-forwards.html">
            
                <a href="a10-unvalidated-redirects-and-forwards.html">
            
                    
                    A10 Unvalidated Redirects and Forwards
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >A3 Cross-site Scripting</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="cross-site-scripting">Cross-site Scripting</h1>
<p><img src="../resources/xss1.png" alt="xss1" title="XSS">
with input <em>Inconspicuous Pizza&lt;script&gt;alert(&apos;Cookie:&apos;+document.cookie)&lt;/script&gt;</em></p>
<h2 id="reflected-xss-in-search-query">Reflected XSS in Search Query</h2>
<p><strong>Note: Chrome XSS Auditor may block XSS Attacks</strong></p>
<p>A Cross-site scripting vulnerability exists in the following URL</p>
<p><a href="http://127.0.0.1:9090/app/products" target="_blank">http://127.0.0.1:9090/app/products</a></p>
<p><strong>Vulnerable Code snippet</strong></p>
<p><em>/views/app/products.ejs</em></p>
<pre><code>...
&lt;% if (output&amp;&amp;output.searchTerm) { %&gt;
    &lt;p class=&quot;bg-success&quot;&gt;
        Listing products with &lt;strong&gt;search query: &lt;/strong&gt; 
        &lt;%- output.searchTerm %&gt;
...
</code></pre><p>User supplied input is directly rendered as part of HTML response. This issue can be exploited to inject arbitrary scripting code to perform a Cross-site Scripting attack.</p>
<p><strong>Solution</strong></p>
<p>Ensure user supplied or any other untrusted data is not rendered as part of HTTP response without appropriate encoding. EJS escape output tag can be used to render this securely with appropriate encoding such as below</p>
<pre><code>&lt;%= output.searchTerm %&gt;
</code></pre><p>Notice the <code>=</code> symbol instead of <code>-</code>, which escapes the output</p>
<h2 id="stored-xss-in-product-listing">Stored XSS in Product Listing</h2>
<p>Another XSS vulnerability exists in the same page, however at a different location</p>
<p><strong>Vulnerable Code snippet</strong></p>
<p><em>/views/app/products.ejs</em></p>
<pre><code>...
&lt;td&gt;&lt;%- output.products[i].id %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%- output.products[i].name %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%- output.products[i].code %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%- output.products[i].tags %&gt;&lt;/td&gt;
...
</code></pre><p><strong>Solution</strong></p>
<p>Enable output string encoding</p>
<pre><code>...
&lt;td&gt;&lt;%= output.products[i].id %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%= output.products[i].name %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%= output.products[i].code %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%= output.products[i].tags %&gt;&lt;/td&gt;
...
</code></pre><p>Notice the <code>=</code> symbol instead of <code>-</code>, which escapes the output</p>
<p><strong>Recommendation</strong></p>
<ul>
<li>Use Security header <code>X-XSS-Protection</code> to prevent reflected XSS attacks</li>
<li>Limit raw rendering to internal trusted data only. Do not disable output encoding for untrusted data coming from external sources</li>
<li>Always validate user input and escape them wherever necessary</li>
<li>Use cookies securely <code>httpOnly</code>, <code>secure</code> are enabled in <code>express-cookies</code>. Refer to <a href="https://expressjs.com/en/advanced/best-practice-security.html" target="_blank">this</a></li>
<li>Use a Content Security policy for your application using a library like <a href="https://www.npmjs.com/package/helmet" target="_blank">helmet</a></li>
</ul>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS" target="_blank">https://www.owasp.org/index.php/Cross-site_Scripting_(XSS</a>)</li>
<li><a href="https://www.npmjs.com/package/xss-filters" target="_blank">https://www.npmjs.com/package/xss-filters</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="a2-broken-auth.html" class="navigation navigation-prev " aria-label="Previous page: A2 Broken Authentication and Session Management">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="a4-idor.html" class="navigation navigation-next " aria-label="Next page: A4 Insecure Direct Object Reference">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"A3 Cross-site Scripting","level":"2.3","depth":1,"next":{"title":"A4 Insecure Direct Object Reference","level":"2.4","depth":1,"path":"solution/a4-idor.md","ref":"solution/a4-idor.md","articles":[]},"previous":{"title":"A2 Broken Authentication and Session Management","level":"2.2","depth":1,"path":"solution/a2-broken-auth.md","ref":"solution/a2-broken-auth.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"solution/a3-xss.md","mtime":"2017-11-14T04:38:13.142Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-11-14T04:51:01.858Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

